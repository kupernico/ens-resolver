# `ENS NFT RESOLVER SERVICE`

Submission for the ETHGlobal [NFT Hackathon 2022](https://nfthack.ethglobal.co/).

As described in the [ENS documentation](https://docs.ens.domains/dapp-developer-guide/ens-as-nft), .eth registrations can be transferred in the same fashion as other NFTs since they implement the [ERC-721](https://ethereum.org/en/developers/docs/standards/tokens/erc-721/) Non-Fungible Token Standard.

This project intents to simplify the resolving of:
- ENS domain to NFT ERC721
- NFT ERC721 to ENS domain

It is deployed as a [Cloudflare Worker](https://developers.cloudflare.com/workers/) using [Wrangler](https://github.com/cloudflare/wrangler). The documentation in this regard can be found [here](https://developers.cloudflare.com/workers/tooling/wrangler/).

## ðŸ”‹ Getting Started

The template for the worker has been generated by running the command:

```bash
wrangler generate ethglobal-nfthack https://github.com/cloudflare/worker-typescript-template
```

### ðŸ‘© ðŸ’» Developing

[`src/index.ts`](./src/index.ts) calls the request handler in [`src/handler.ts`](./src/handler.ts), and will return the [request method](https://developer.mozilla.org/en-US/docs/Web/API/Request/method) for the given request.

The handlers have been implemented as in the [ENS documentation](https://docs.ens.domains/dapp-developer-guide/ens-as-nft):
- [`src/domain2token.ts`](./src/domain2token.ts) - derives the NFT Token ID of the ENS name as the uint256 representation of the hash of the domain label.
- [`src/token2domain.ts`](./src/token2domain.ts) - queries [TheGraph](https://thegraph.com) ENS subgraph to decode the given NFT Token ID.
- [`src/domain2avatar.ts`](./src/domain2avatar.ts) - queries [Ethers](https://docs.ethers.io/v5/) to retrieve the avatar associated to a domain.


### ðŸ§ª Testing

The functionality of the service can be demostrated as follows:

- https://ethglobal-nfthack.kupernico.workers.dev/ens/resolver/kupernico/erc721 - retrieves the NFT Token ID given the domain label 'kupernico'.

- https://ethglobal-nfthack.kupernico.workers.dev/ens/resolver/101999766799224747095748306913918986390319067730498280272548597342427873144316/domain - resolves the NFT Token ID to the domain label 'kupernico'

### ðŸ‘€ Previewing and Publishing

- `wrang dev` - deploys to localhost
- `wrang publish` - deploys to [Cloudflare](https://cloudflare.com)

More information on how to preview and publish a worker is available at [Wrangler docs](https://developers.cloudflare.com/workers/tooling/wrangler/commands/#publish).

### ðŸ”¨ Credits

- [ENS Domains](https://ens.domains/)
- [Cloudflare Workers](https://developers.cloudflare.com/workers/) to deploy the project as a microservice.
- [Ethers.js](https://docs.ethers.io/v5/)
- [TheGraph](https://thegraph.com/en/)
